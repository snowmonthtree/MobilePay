<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>支付结果</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-container">
      <!-- 状态栏 -->

      <!-- 支付结果页面 -->
      <div class="payment-result-page">
        <!-- 页面头部 -->
        <div class="page-header">
          <button class="back-btn" onclick="goBack()">
            <img src="icons/danjiantouzuo.png" alt="返回" />
          </button>
          <h1>支付结果</h1>
          <div class="header-placeholder"></div>
        </div>

        <!-- 支付结果内容 -->
        <div class="result-content">
          <!-- 成功状态 -->
          <div class="result-success" id="successResult">
            <div class="result-icon success">
              <img src="icons/chenggong.png" alt="支付成功" />
            </div>
            <h2 class="result-title">支付成功</h2>
            <div class="result-amount">
              ¥<span id="successAmount">128.00</span>
            </div>

            <div class="result-details">
              <div class="detail-item">
                <span class="detail-label">商户名称</span>
                <span class="detail-value" id="merchantName">星巴克咖啡</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">支付方式</span>
                <span class="detail-value" id="paymentMethod">钱包余额</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">交易时间</span>
                <span class="detail-value" id="paymentTime"
                  >2024-01-15 14:30:25</span
                >
              </div>
              <div class="detail-item">
                <span class="detail-label">交易单号</span>
                <span class="detail-value" id="transactionId"
                  >202401151430251234567</span
                >
              </div>
            </div>
          </div>

          <!-- 失败状态 -->
          <div class="result-failure" id="failureResult" style="display: none">
            <div class="result-icon failure">
              <img src="icons/shibai.png" alt="支付失败" />
            </div>
            <h2 class="result-title">支付失败</h2>
            <div class="failure-reason" id="failureReason">
              余额不足，请充值后重试
            </div>

            <div class="result-details">
              <div class="detail-item">
                <span class="detail-label">商户名称</span>
                <span class="detail-value" id="failMerchantName"
                  >星巴克咖啡</span
                >
              </div>
              <div class="detail-item">
                <span class="detail-label">失败时间</span>
                <span class="detail-value" id="failureTime"
                  >2024-01-15 14:30:25</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- 操作按钮 -->
        <div class="payment-result-actions">
          <div class="success-actions" id="successActions">
            <button class="payment-result-action-btn secondary" onclick="viewBills()">
              <img src="icons/a-27-lishishuju.png" alt="查看账单" />
              <span>查看账单</span>
            </button>
            <button class="payment-result-action-btn secondary" onclick="goHome()">
              <img src="icons/a-1-gongzuotai.png" alt="返回首页" />
              <span>返回首页</span>
            </button>
          </div>

          <div
            class="failure-actions"
            id="failureActions"
            style="display: none"
          >
            <button class="payment-result-action-btn secondary" onclick="retryPayment()">
              <img src="icons/shuaxin.png" alt="重新支付" />
              <span>重新支付</span>
            </button>
            <button class="payment-result-action-btn secondary" onclick="goHome()">
              <img src="icons/a-1-gongzuotai.png" alt="返回首页" />
              <span>返回首页</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 支付结果页模块：统一封装页面逻辑，消除全局变量，集中管理状态与功能
 const PaymentResultModule = {
     // 1. 状态管理：存储模块核心配置与页面参数
     state: {
         // 默认参数配置：统一管理默认值，便于后续修改
         defaultParams: {
             status: "success",
             amount: "128.00",
             merchant: "星巴克咖啡",
             method: "钱包余额",
             reason: "余额不足，请充值后重试"
         },
         pageParams: {} // 存储解析后的URL参数，避免重复处理
     },

     // 2. 初始化：页面加载后执行所有初始化逻辑
     init() {
         document.addEventListener("DOMContentLoaded", () => {
             this.state.pageParams = this.getUrlParams(); // 解析并缓存URL参数
             this.initPage(); // 初始化页面显示（成功/失败结果）
         });

         // 暴露全局方法：兼容HTML中的onclick调用
         this.exposeGlobalMethods();
     },

     // 暴露全局方法：确保外部可调用模块内功能
     exposeGlobalMethods() {
         window.goBack = () => this.goBack();
         window.viewBills = () => this.viewBills();
         window.goHome = () => this.goHome();
         window.retryPayment = () => this.retryPayment();
     },

     // 3. URL参数处理：解析并补全默认值
     /**
      * 解析URL参数，缺失时使用默认值，确保参数完整性
      * @returns {Object} 格式化后的页面参数
      */
     getUrlParams() {
         const urlParams = new URLSearchParams(window.location.search);
         const currentTime = new Date().toLocaleString("zh-CN");

         // 合并URL参数与默认值，URL参数优先级更高
         return {
             status: urlParams.get("status") || this.state.defaultParams.status,
             amount: urlParams.get("amount") || this.state.defaultParams.amount,
             merchant: urlParams.get("merchant") || this.state.defaultParams.merchant,
             method: urlParams.get("method") || this.state.defaultParams.method,
             time: urlParams.get("time") || currentTime,
             transaction: urlParams.get("transaction") || this.generateTransactionId(),
             reason: urlParams.get("reason") || this.state.defaultParams.reason
         };
     },

     // 4. 页面初始化：根据支付状态显示对应结果
     /**
      * 初始化页面核心逻辑：根据参数中的支付状态，切换成功/失败结果显示
      */
     initPage() {
         const { status } = this.state.pageParams;
         status === "success"
             ? this.showSuccessResult()
             : this.showFailureResult();
     },

     // 5. 结果显示：成功/失败状态切换与数据填充
     /**
      * 显示支付成功结果：切换DOM显示状态，填充成功数据
      */
     showSuccessResult() {
         const { amount, merchant, method, time, transaction } = this.state.pageParams;

         // 切换结果容器显示状态
         this.toggleResultContainer("success");

         // 填充成功页面数据
         document.getElementById("successAmount").textContent = amount;
         document.getElementById("merchantName").textContent = merchant;
         document.getElementById("paymentMethod").textContent = method;
         document.getElementById("paymentTime").textContent = time;
         document.getElementById("transactionId").textContent = transaction;
     },

     /**
      * 显示支付失败结果：切换DOM显示状态，填充失败数据
      */
     showFailureResult() {
         const { reason, merchant, time } = this.state.pageParams;

         // 切换结果容器显示状态
         this.toggleResultContainer("failure");

         // 填充失败页面数据
         document.getElementById("failureReason").textContent = reason;
         document.getElementById("failMerchantName").textContent = merchant;
         document.getElementById("failureTime").textContent = time;
     },

     /**
      * 切换成功/失败结果容器显示状态（统一处理，减少重复代码）
      * @param {string} resultType - 结果类型（success/failure）
      */
     toggleResultContainer(resultType) {
         // 成功结果相关元素
         const successResult = document.getElementById("successResult");
         const successActions = document.getElementById("successActions");
         // 失败结果相关元素
         const failureResult = document.getElementById("failureResult");
         const failureActions = document.getElementById("failureActions");

         if (resultType === "success") {
             successResult.style.display = "block";
             failureResult.style.display = "none";
             successActions.style.display = "flex";
             failureActions.style.display = "none";
         } else {
             successResult.style.display = "none";
             failureResult.style.display = "block";
             successActions.style.display = "none";
             failureActions.style.display = "flex";
         }
     },

     // 6. 工具方法：交易号生成与页面导航
     /**
      * 生成唯一交易单号（格式：时间戳+7位随机数，确保唯一性）
      * @returns {string} 格式化的交易单号
      */
     generateTransactionId() {
         const now = new Date();
         // 生成时间戳（YYYYMMDDHHmmss）
         const timestamp = `${now.getFullYear()}` +
             `${String(now.getMonth() + 1).padStart(2, "0")}` +
             `${String(now.getDate()).padStart(2, "0")}` +
             `${String(now.getHours()).padStart(2, "0")}` +
             `${String(now.getMinutes()).padStart(2, "0")}` +
             `${String(now.getSeconds()).padStart(2, "0")}`;

         // 生成7位随机数（补零确保长度一致）
         const randomNum = String(Math.floor(Math.random() * 10000000)).padStart(7, "0");

         return timestamp + randomNum;
     },

     /**
      * 返回上一页
      */
     goBack() {
         window.history.back();
     },

     /**
      * 跳转到账单页面
      */
     viewBills() {
         window.location.href = "bills.html";
     },

     /**
      * 返回首页
      */
     goHome() {
         window.location.href = "index.html";
     },

     /**
      * 重新支付（跳转到扫码支付页）
      */
     retryPayment() {
         window.location.href = "scan.html";
     }
 };

 // 初始化支付结果页模块
 PaymentResultModule.init();
    </script>
  </body>
</html>
