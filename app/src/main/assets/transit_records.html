<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出行记录 - 移动支付应用</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* 基础样式重置与工具类 */
        :root {
            --primary-color: #409EFF;
            --primary-light: #e0e7ff;
            --secondary-color: #3f37c9;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 0.375rem;
            --transition: all 0.3s ease;
        }

        .transit-records-page {
            padding: 20px;
            padding-top: 0;
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .page-header {
            display: flex;
            align-items: center;
            padding: 15px 0;
            position: relative;
        }

        .back-btn {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
        }

        .back-btn img {
            width: 20px;
            height: 20px;
        }

        .page-header h1 {
            flex: 1;
            text-align: center;
            font-size: 18px;
            margin: 0;
        }

        .filter-btn {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
        }

        .filter-btn img {
            width: 20px;
            height: 20px;
        }

        .records-filter {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .filter-tabs {
            display: flex;
        }

        .filter-tab {
            padding: 6px 12px;
            margin-right: 8px;
            border-radius: 16px;
            font-size: 14px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
        }

        .filter-tab.active {
            background: #1677ff;
            color: white;
        }

        .date-filter {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #666;
        }

        .date-filter img {
            width: 16px;
            height: 16px;
            margin-left: 4px;
        }

        .records-list {
            flex: 1;
            overflow-y: auto;
        }

        .record-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            flex-direction: column;
        }

        .record-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            width: 100%;
        }

        .record-title {
            font-weight: bold;
            font-size: 16px;
        }

        .record-status {
            font-size: 14px;
            padding: 2px 8px;
            border-radius: 10px;
            background: #e6f7ff;
            color: #1677ff;
        }

        .record-status.error {
            background: #fff2f0;
            color: #ff4d4f;
        }

        .record-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }

        .info-value {
            color: #333;
        }

        .info-value.amount {
            font-weight: bold;
            color: #ff4d4f;
        }

        .record-time {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 12px;
            width: 100%;
        }

        .empty-records {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
            color: #999;
        }

        .empty-records img {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .close-btn:hover {
            background-color: var(--gray-200);
        }

        .close-btn img {
            width: 1.25rem;
            height: 1.25rem;
            object-fit: contain;
        }

        /* 日期选择内容区域样式 */
        .date-picker-content {
            padding: 1.5rem;
        }

        .date-range-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: var(--border-radius);
            background-color: white;
            border: 1px solid var(--gray-200);
            cursor: pointer;
            transition: var(--transition);
        }

        .date-range-option:last-child {
            margin-bottom: 0;
        }

        .date-range-option:hover {
            background-color: var(--primary-light);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .date-range-option span {
            flex: 1;
            font-size: 1rem;
            color: var(--gray-700);
            font-weight: 500;
        }

        /* 自定义日期选择器（隐藏状态） */
        .custom-date-picker {
            display: none;
            margin-top: 1rem;
            gap: 1rem;
        }

        /* 响应式设计 */
        @media (max-width: 480px) {
            .modal-content {
                width: 95%;
            }

            .modal-header {
                padding: 1rem;
            }

            .date-picker-content {
                padding: 1rem;
            }

            .date-range-option {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
        }

        .handle-options {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
        }

        .btn-option {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            font-size: 14px;
            border-radius: 1.25rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-option img {
            width: 20px;
            height: 20px;
            filter: brightness(0) invert(1);
        }

        /* 详情页面样式 */
        .transit-detail-content {
            padding: 0px;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }

        .detail-title {
            font-size: 18px;
            font-weight: bold;
        }

        .detail-status {
            font-size: 14px;
            padding: 4px 10px;
            margin: 0;
            border-radius: 12px;
            background: #e6f7ff;
            color: #1677ff;
        }

        .detail-status.error {
            background: #fff2f0;
            color: #ff4d4f;
        }

        .detail-map {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .station-line {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .station {
            width: 100%;
            padding: 12px;
            background: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            position: relative;
            z-index: 2;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .station.start {
            border-left: 4px solid #52c41a;
            margin-bottom: 30px;
        }

        .station.end {
            border-left: 4px solid #1677ff;
        }

        .station.error {
            border-left: 4px solid #ff4d4f;
            color: #ff4d4f;
        }

        .line-path {
            position: absolute;
            top: 45px;
            height: calc(100% - 90px);
            width: 4px;
            background: #1677ff;
            z-index: 1;
        }

        .line-path.error {
            background: #ff4d4f;
            border-right: 2px dashed #ff4d4f;
        }

        .detail-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-group {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: 500;
            color: #333;
        }

        .info-value.error {
            color: #ff4d4f;
        }

        .info-value.amount {
            color: #ff4d4f;
            font-weight: bold;
        }

        .error-message {
            margin-top: 15px;
            padding: 10px 15px;
            background: #fff2f0;
            border-radius: 8px;
            border-left: 4px solid #ff4d4f;
            color: #ff4d4f;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px 20px;
            border-top: 1px solid #eee;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
        }

        /* 交互效果 */
        .btn-option:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        /* 动画效果 */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .error-message {
            animation: pulse 2s infinite;
        }

        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* 响应式设计 */
        @media (max-width: 360px) {
            .transit-detail-content {
                padding: 15px;
            }

            .detail-title {
                font-size: 16px;
            }

            .detail-status {
                font-size: 12px;
                padding: 3px 8px;
            }

            .station {
                padding: 10px;
                font-size: 14px;
            }

            .info-item {
                font-size: 13px;
            }

            .btn-secondary {
                padding: 8px 15px;
                font-size: 14px;
            }

            .handle-options {
                flex-wrap: wrap;
            }

            .btn-option {
                flex: 1;
                min-width: 100px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- 顶部状态栏 -->

        <!-- 出行记录页面 -->
        <div class="transit-records-page">
            <!-- 头部导航 -->
            <div class="page-header">
                <button class="back-btn" onclick="goBack()">
                    <img src="icons/danjiantouzuo.png" alt="返回">
                </button>
                <h1>出行记录</h1>
                <div class="header-placeholder"></div>
            </div>

            <!-- 筛选区域 -->
            <div class="records-filter">
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterRecords('all')">全部</button>
                    <button class="filter-tab" onclick="filterRecords('normal')">正常</button>
                    <button class="filter-tab" onclick="filterRecords('error')">异常</button>
                </div>
                <div class="date-filter" onclick="showDatePicker()">
                    <span>最近30天</span>
                    <img src="icons/danjiantouxia.png" alt="选择日期">
                </div>
            </div>

            <!-- 记录列表 -->
            <div class="records-list" id="recordsList">
                <!-- 记录项 - 正常记录 -->
                <div class="record-item" onclick="navigateToDetail('record1')">
                    <div class="record-header">
                        <div class="record-title">北京地铁</div>
                        <div class="record-status">正常</div>
                    </div>
                    <div class="record-info">
                        <div class="info-item">
                            <span class="info-label">进站：</span>
                            <span class="info-value">天安门东站</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出站：</span>
                            <span class="info-value">王府井站</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">费用：</span>
                            <span class="info-value amount">¥4.00</span>
                        </div>
                    </div>
                    <div class="record-time">2025-07-10 14:30</div>
                </div>

                <!-- 记录项 - 异常记录 -->
                <div class="record-item" onclick="navigateToDetail('record2')">
                    <div class="record-header">
                        <div class="record-title">北京公交</div>
                        <div class="record-status error">异常</div>
                    </div>
                    <div class="record-info">
                        <div class="info-item">
                            <span class="info-label">进站：</span>
                            <span class="info-value">西单站</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出站：</span>
                            <span class="info-value">未记录</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">费用：</span>
                            <span class="info-value amount">¥0.00</span>
                        </div>
                    </div>
                    <div class="record-time">2025-07-09 09:15</div>
                </div>

                <!-- 记录项 - 正常记录 -->
                <div class="record-item" onclick="navigateToDetail('record3')">
                    <div class="record-header">
                        <div class="record-title">北京地铁</div>
                        <div class="record-status">正常</div>
                    </div>
                    <div class="record-info">
                        <div class="info-item">
                            <span class="info-label">进站：</span>
                            <span class="info-value">北京南站</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出站：</span>
                            <span class="info-value">西单站</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">费用：</span>
                            <span class="info-value amount">¥5.00</span>
                        </div>
                    </div>
                    <div class="record-time">2025-07-08 18:45</div>
                </div>
            </div>
        </div>

        <!-- 记录详情弹窗已移除，改为页面跳转 -->

        <!-- 日期选择弹窗 -->
        <div class="modal" id="datePickerModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>选择日期范围</h2>
                    <button class="close-btn" onclick="closeModal('datePickerModal')">
                        <img src="icons/shibai.png" alt="关闭">
                    </button>
                </div>
                <div class="date-picker-content">
                    <div class="date-range-option" onclick="selectDateRange('7days')">
                        <span>最近7天</span>
                    </div>
                    <div class="date-range-option" onclick="selectDateRange('30days')">
                        <span>最近30天</span>
                    </div>
                    <div class="date-range-option" onclick="selectDateRange('90days')">
                        <span>最近90天</span>
                    </div>
                    <div class="date-range-option" onclick="showCustomDatePicker()">
                        <span>自定义</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 异常处理弹窗 -->
        <div class="modal" id="errorHandleModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>异常处理</h2>
                    <button class="close-btn" onclick="closeModal('errorHandleModal')">
                        <img src="icons/shibai.png" alt="关闭">
                    </button>
                </div>
                <div class="error-handle-content">
                    <div class="detail-rules">
                        <p style="margin-bottom: 10px;">您的出行记录存在异常，可能是由于以下原因：</p>
                        <ul>
                            <li>未正常出站或刷卡</li>
                            <li>系统记录错误</li>
                            <li>支付失败</li>
                        </ul>
                    </div>
                    <div class="handle-options">
                        <button class="btn-option" onclick="contactCustomerService()">
                            <img src="icons/kefu.png" alt="客服">
                            <span>联系客服</span>
                        </button>
                        <button class="btn-option" onclick="payNow()">
                            <img src="icons/tuikuanjingban.png" alt="支付">
                            <span>立即补缴</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // 出行记录列表模块：统一封装记录加载、筛选、渲染等核心功能
 const TransitRecordsModule = {
     // 1. 状态管理：存储模块核心配置、DOM元素缓存与临时数据
     state: {
         // API配置
         apiConfig: {
             recordsUrl: "http://graywolf.top:6031/payment/transit/records",
             headers: {
                 "User-Agent": "Apifox/1.0.0 (https://apifox.com)",
                 "Accept": "*/*"
             }
         },

         // DOM元素缓存
         elements: {
             recordsList: null,        // 记录列表容器
             datePickerModal: null,    // 日期选择弹窗
             errorHandleModal: null    // 异常处理弹窗
         },

         // 临时数据
         currentFilter: "all",       // 当前筛选类型（all/normal/error）
         currentDateRange: "7days"   // 当前日期范围
     },

     // 2. 初始化：页面加载后执行DOM缓存、事件绑定与记录加载
     init() {
         document.addEventListener("DOMContentLoaded", () => {
             this.cacheDomElements();  // 缓存DOM元素
             this.bindGlobalMethods(); // 暴露全局方法（兼容HTML onclick）
             this.initTransitRecords(); // 初始化记录列表
         });
     },

     // 缓存DOM元素引用，减少重复查询
     cacheDomElements() {
         this.state.elements.recordsList = document.getElementById("recordsList");
         this.state.elements.datePickerModal = document.getElementById("datePickerModal");
         this.state.elements.errorHandleModal = document.getElementById("errorHandleModal");
     },

     // 暴露全局方法到window对象（兼容HTML中的onclick调用）
     bindGlobalMethods() {
         window.filterRecords = (type) => this.filterRecords(type);
         window.showFilterOptions = () => this.showFilterOptions();
         window.showDatePicker = () => this.showDatePicker();
         window.selectDateRange = (range) => this.selectDateRange(range);
         window.showCustomDatePicker = () => this.showCustomDatePicker();
         window.navigateToDetail = (transactionId) => this.navigateToDetail(transactionId);
         window.handleErrorRecord = () => this.handleErrorRecord();
         window.contactCustomerService = () => this.contactCustomerService();
         window.payNow = () => this.payNow();
         window.closeModal = (modalId) => this.closeModal(modalId);
     },

     // 3. 记录列表初始化与加载
     /**
      * 初始化交通出行记录列表（加载并渲染记录）
      */
     initTransitRecords() {
         const { recordsList } = this.state.elements;
         if (!recordsList) {
             console.error("未找到记录列表容器");
             return;
         }

         // 显示加载状态
         recordsList.innerHTML = '<div class="records-loading">加载记录中...</div>';

         // 获取用户Token（验证登录状态）
         const token = this.getUserToken();
         if (!token) {
             recordsList.innerHTML = '<div class="records-error">请先登录</div>';
             return;
         }

         // 调用记录列表接口
         fetch(`${this.state.apiConfig.recordsUrl}?limit=100`, {
             method: "GET",
             headers: {
                 ...this.state.apiConfig.headers,
                 "Authorization": `Bearer ${token}`
             }
         })
             .then(response => {
                 if (!response.ok) throw new Error(`请求失败: ${response.status}`);
                 return response.json();
             })
             .then(result => {
                 if (result.code !== 200 || !Array.isArray(result.data)) {
                     throw new Error(result.message || "获取记录失败");
                 }
                 // 渲染记录列表
                 this.renderTransitRecords(result.data);
             })
             .catch(error => {
                 console.error("加载记录出错:", error);
                 recordsList.innerHTML = `<div class="records-error">${error.message || "加载失败，请重试"}</div>`;
             });
     },

     /**
      * 渲染交通记录列表到页面
      * @param {Array} records - 记录数据数组
      */
     renderTransitRecords(records) {
         const { recordsList } = this.state.elements;
         if (!recordsList) return;

         // 清空容器
         recordsList.innerHTML = "";

         // 处理无记录场景
         if (records.length === 0) {
             recordsList.innerHTML = `
                 <div class="empty-records">
                     <img src="icons/a-27-lishishuju.png" alt="无记录">
                     <p>暂无出行记录</p>
                 </div>
             `;
             return;
         }

         // 遍历记录生成DOM
         records.forEach(record => {
             // 数据预处理
             const isAbnormal = record.status === 2; // status=2为异常状态
             const modeText = record.mode === "SUBWAY" ? "北京地铁" : "公共交通";
             const statusText = isAbnormal ? "异常" : "正常";
             const statusClass = isAbnormal ? "error" : "";
             const timeSource = record.exitTime || record.entryTime; // 优先显示出站时间
             const formattedTime = this.formatRecordTime(timeSource);
             const entrySite = record.entrySiteName || "未记录";
             const exitSite = record.exitSiteName || "未记录";
             const amount = this.formatAmount(record.actualAmount);

             // 创建记录项元素
             const recordItem = document.createElement("div");
             recordItem.className = "record-item";
             recordItem.dataset.transactionId = record.transactionId || ""; // 存储记录ID
             recordItem.addEventListener("click", () => this.handleRecordClick(record.transactionId));

             // 填充记录内容
             recordItem.innerHTML = `
                 <div class="record-header">
                     <div class="record-title">${modeText}</div>
                     <div class="record-status ${statusClass}">${statusText}</div>
                 </div>
                 <div class="record-info">
                     <div class="info-item">
                         <span class="info-label">进站：</span>
                         <span class="info-value">${entrySite}（${record.entrySiteLine || ""}）</span>
                     </div>
                     <div class="info-item">
                         <span class="info-label">出站：</span>
                         <span class="info-value">${exitSite}（${record.exitSiteLine || ""}）</span>
                     </div>
                     <div class="info-item">
                         <span class="info-label">费用：</span>
                         <span class="info-value amount">¥${amount}</span>
                     </div>
                 </div>
                 <div class="record-time">${formattedTime}</div>
             `;

             recordsList.appendChild(recordItem);
         });
     },

     // 4. 记录筛选与日期过滤
     /**
      * 筛选记录（全部/正常/异常）
      * @param {string} type - 筛选类型（all/normal/error）
      */
     filterRecords(type) {
         // 验证事件源与筛选类型
         if (!event || !["all", "normal", "error"].includes(type)) return;

         // 更新筛选按钮状态
         document.querySelectorAll(".filter-tab").forEach(tab => {
             tab.classList.remove("active");
         });
         event.target.classList.add("active");
         this.state.currentFilter = type;

         // 执行筛选逻辑
         const recordItems = document.querySelectorAll(".record-item");
         recordItems.forEach(item => {
             const status = item.querySelector(".record-status");
             const isError = status?.classList.contains("error") || false;

             // 根据筛选类型设置显示状态
             if (type === "all") {
                 item.style.display = "block";
             } else if (type === "normal") {
                 item.style.display = !isError ? "block" : "none";
             } else if (type === "error") {
                 item.style.display = isError ? "block" : "none";
             }
         });

         // 检查筛选后是否有可见记录
         this.checkEmptyRecords();
     },

     /**
      * 检查筛选后是否有可见记录（无记录则显示空状态）
      */
     checkEmptyRecords() {
         const { recordsList } = this.state.elements;
         if (!recordsList) return;

         // 获取所有可见记录
         const visibleRecords = Array.from(document.querySelectorAll(".record-item"))
             .filter(item => window.getComputedStyle(item).display !== "none");

         const existingEmpty = document.querySelector(".empty-records");

         // 无可见记录且无空状态元素时，添加空状态
         if (visibleRecords.length === 0 && !existingEmpty) {
             const emptyElement = document.createElement("div");
             emptyElement.className = "empty-records";
             emptyElement.innerHTML = `
                 <img src="icons/a-27-lishishuju.png" alt="无记录">
                 <p>暂无出行记录</p>
             `;
             recordsList.appendChild(emptyElement);
         }
         // 有可见记录但有空状态元素时，移除空状态
         else if (visibleRecords.length > 0 && existingEmpty) {
             existingEmpty.remove();
         }
     },

     /**
      * 显示日期选择器弹窗
      */
     showDatePicker() {
         const { datePickerModal } = this.state.elements;
         if (datePickerModal) {
             datePickerModal.style.display = "flex";
         }
     },

     /**
      * 选择日期范围并更新显示
      * @param {string} range - 日期范围标识（7days/30days/90days/custom）
      */
     selectDateRange(range) {
         // 映射范围标识到显示文本
         const rangeMap = {
             "7days": "最近7天",
             "30days": "最近30天",
             "90days": "最近90天",
             "custom": "自定义"
         };
         const rangeText = rangeMap[range] || "自定义";

         // 更新日期筛选显示
         const dateFilter = document.querySelector(".date-filter span");
         if (dateFilter) {
             dateFilter.textContent = rangeText;
         }

         // 关闭弹窗并模拟加载数据
         this.closeModal("datePickerModal");
         this.state.currentDateRange = range;

         // 模拟加载新数据（实际项目中可调用接口）
         const loading = this.showLoading();
         setTimeout(() => {
             this.hideLoading(loading);
             this.showToast(`已加载${rangeText}数据`);
         }, 1000);
     },

     /**
      * 显示筛选选项（预留功能）
      */
     showFilterOptions() {
         this.showToast("筛选功能");
     },

     /**
      * 显示自定义日期选择器（预留功能）
      */
     showCustomDatePicker() {
         this.showToast("自定义日期选择");
         this.closeModal("datePickerModal");
     },

     // 5. 记录交互与异常处理
     /**
      * 处理记录项点击（跳转到详情页）
      * @param {string} transactionId - 记录ID
      */
     handleRecordClick(transactionId) {
         if (transactionId) {
             this.navigateToDetail(transactionId);
         }
     },

     /**
      * 跳转到记录详情页面
      * @param {string} transactionId - 记录ID
      */
     navigateToDetail(transactionId) {
         if (transactionId) {
             window.location.href = `transit_detail.html?id=${transactionId}`;
         }
     },

     /**
      * 处理异常记录（显示异常处理弹窗）
      */
     handleErrorRecord() {
         const { errorHandleModal } = this.state.elements;
         if (errorHandleModal) {
             errorHandleModal.style.display = "flex";
         }
     },

     /**
      * 联系客服（处理异常记录时）
      */
     contactCustomerService() {
         this.closeModal("errorHandleModal");
         this.showToast("正在连接客服...");
         // 实际项目中可添加跳转客服页面逻辑
     },

     /**
      * 立即补缴（处理异常记录时）
      */
     payNow() {
         this.closeModal("errorHandleModal");
         this.showToast("正在准备支付...");
         // 延迟跳转支付页面，模拟加载过程
         setTimeout(() => {
             window.location.href = "payment.html?amount=3&merchant=出行补缴";
         }, 1000);
     },

     /**
      * 关闭弹窗
      * @param {string} modalId - 弹窗ID
      */
     closeModal(modalId) {
         const modal = document.getElementById(modalId);
         if (modal) {
             modal.style.display = "none";
         }
     },

     // 6. 通用工具方法
     /**
      * 获取用户Token（从本地存储解析）
      * @returns {string} 用户Token（空字符串表示获取失败）
      */
     getUserToken() {
         try {
             const userData = JSON.parse(localStorage.getItem("userData") || "{}");
             return userData.token || "";
         } catch (error) {
             console.error("解析用户token失败:", error);
             return "";
         }
     },

     /**
      * 格式化记录时间（转为 "YYYY-MM-DD HH:mm" 格式）
      * @param {string} timeStr - 原始时间字符串
      * @returns {string} 格式化后的时间
      */
     formatRecordTime(timeStr) {
         if (!timeStr) return "未知时间";

         try {
             const date = new Date(timeStr);
             return `${date.getFullYear()}-${
                 String(date.getMonth() + 1).padStart(2, "0")
             }-${
                 String(date.getDate()).padStart(2, "0")
             } ${
                 String(date.getHours()).padStart(2, "0")
             }:${
                 String(date.getMinutes()).padStart(2, "0")
             }`;
         } catch (error) {
             console.error("时间格式化失败:", error);
             // 降级处理：移除T分隔符并保留时分
             return timeStr.replace("T", " ").split(":").slice(0, 2).join(":");
         }
     },

     /**
      * 格式化金额（保留2位小数）
      * @param {number|null} amount - 原始金额
      * @returns {string} 格式化后的金额
      */
     formatAmount(amount) {
         if (amount === null || isNaN(amount)) return "0.00";
         return parseFloat(amount).toFixed(2);
     },

     /**
      * 显示加载状态
      * @returns {HTMLElement} 加载元素
      */
     showLoading() {
         const loading = document.createElement("div");
         loading.className = "loading";
         loading.textContent = "加载中...";
         document.body.appendChild(loading);
         return loading;
     },

     /**
      * 隐藏加载状态
      * @param {HTMLElement} loading - 加载元素
      */
     hideLoading(loading) {
         if (loading && loading.parentNode) {
             loading.parentNode.removeChild(loading);
         }
     },

     /**
      * 显示提示信息（兼容Android原生与Web环境）
      * @param {string} message - 提示内容
      */
     showToast(message) {
         if (window.AndroidInterface && typeof window.AndroidInterface.showToast === "function") {
             window.AndroidInterface.showToast(message);
         } else {
             alert(message); // Web环境降级使用alert
         }
     }
 };

 // 初始化出行记录列表模块
 TransitRecordsModule.init();
    </script>
</body>

</html>