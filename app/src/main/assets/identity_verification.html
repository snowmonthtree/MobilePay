<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>身份审核 - 移动支付应用</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .verification-page {
            padding: 20px 20px 80px;
            background: #f8f9fa;
        }

        .verification-header {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .back-btn {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
        }

        .back-btn img {
            width: 20px;
            height: 20px;
        }

        .verification-status {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.verified {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-message {
            margin-top: 12px;
            font-size: 14px;
            color: #666;
        }

        .verification-form {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .form-title {
            font-size: 18px;
            margin-bottom: 16px;
            color: #333;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            border-color: #667eea;
            outline: none;
        }

        .upload-section {
            margin-bottom: 16px;
        }

        .upload-title {
            font-size: 14px;
            margin-bottom: 12px;
            color: #333;
            font-weight: 500;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 12px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 12px;
        }

        .upload-icon img {
            width: 100%;
            height: 100%;
        }

        .upload-text {
            font-size: 14px;
            color: #666;
        }

        .upload-preview {
            display: none;
            margin-top: 12px;
            position: relative;
        }

        .preview-image {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .remove-image {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .remove-image img {
            width: 14px;
            height: 14px;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .verification-tips {
            background: #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .tips-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tips-title img {
            width: 16px;
            height: 16px;
        }

        .tips-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tips-list li {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            padding-left: 16px;
            position: relative;
        }

        .tips-list li:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #667eea;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- 顶部状态栏 -->


        <!-- 身份审核页面 -->
        <div class="verification-page" id="verificationPage">
            <div class="verification-header">
                <button class="back-btn" onclick="goToProfile()">
                    <img src="icons/danjiantouzuo.png" alt="返回">
                </button>
                <h3>身份审核</h3>
                <div class="header-placeholder"></div>
            </div>

            <!-- 审核状态展示 -->
            <div class="verification-status" id="verificationStatus">
                <h3>审核状态<span class="status-badge pending" id="statusBadge">待审核</span></h3>
                <p class="status-message" id="statusMessage">您的身份审核资料已提交，我们将在1-3个工作日内完成审核，请耐心等待。</p>
            </div>

            <!-- 身份审核表单 -->
            <div class="verification-form" id="verificationForm">
                <h3 class="form-title">身份信息</h3>
                <div class="form-group">
                    <label class="form-label">真实姓名</label>
                    <input type="text" class="form-input" id="realName" placeholder="请输入您的真实姓名">
                </div>

                <div class="form-group">
                    <label class="form-label">身份证号码</label>
                    <input type="text" class="form-input" id="idNumber" placeholder="请输入18位身份证号码">
                </div>

                <div class="upload-section">
                    <div class="upload-title">身份证正面照片</div>
                    <div class="upload-area" id="frontIdUpload" onclick="triggerUpload('frontId')">
                        <div class="upload-icon">
                            <img src="icons/yingxiangshangchuan.png" alt="上传">
                        </div>
                        <div class="upload-text">点击上传身份证正面照片</div>
                        <input type="file" id="frontIdInput" style="display: none;" accept="image/*"
                            onchange="handleImageUpload(this, 'frontIdPreview')">
                    </div>
                    <div class="upload-preview" id="frontIdPreview">
                        <img class="preview-image" id="frontIdImage" src="" alt="身份证正面预览">
                        <div class="remove-image" onclick="removeImage('frontId')">
                            <img src="icons/shanchu.png" alt="删除">
                        </div>
                    </div>
                </div>

                <div class="upload-section">
                    <div class="upload-title">身份证反面照片</div>
                    <div class="upload-area" id="backIdUpload" onclick="triggerUpload('backId')">
                        <div class="upload-icon">
                            <img src="icons/yingxiangshangchuan.png" alt="上传">
                        </div>
                        <div class="upload-text">点击上传身份证反面照片</div>
                        <input type="file" id="backIdInput" style="display: none;" accept="image/*"
                            onchange="handleImageUpload(this, 'backIdPreview')">
                    </div>
                    <div class="upload-preview" id="backIdPreview">
                        <img class="preview-image" id="backIdImage" src="" alt="身份证反面预览">
                        <div class="remove-image" onclick="removeImage('backId')">
                            <img src="icons/shanchu.png" alt="删除">
                        </div>
                    </div>
                </div>

                <button class="submit-btn" id="submitBtn" onclick="submitVerification()">提交审核</button>
            </div>

            <!-- 审核提示 -->
            <div class="verification-tips">
                <div class="tips-title">
                    <img src="icons/tixinglaba.png" alt="提示">
                    <span>审核须知</span>
                </div>
                <ul class="tips-list">
                    <li>请确保上传的证件照片清晰完整，无遮挡、无反光</li>
                    <li>身份信息必须与证件信息一致，否则将无法通过审核</li>
                    <li>审核通过后将获得完整的支付和转账功能</li>
                </ul>
            </div>

            <!-- 模拟审核结果（仅用于原型演示） -->

        <!-- 底部导航 -->

        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // 身份验证审核模块：统一封装，消除全局变量，集中管理状态与功能
const VerificationModule = {
    // 1. 状态管理：存储模块内关键数据（避免全局变量污染）
    state: {
        apiConfig: {
            baseUrl: "http://graywolf.top:6031/app",
            maxImageSize: 5 * 1024 * 1024, // 图片最大限制（5MB）
            headers: {
                "User-Agent": "Apifox/1.0.0 (https://apifox.com)",
                "Accept": "*/*"
            }
        },
        uploadedImages: {}, // 存储已上传图片（frontId/backId）
        currentUploadType: "" // 当前上传类型（用于原生相册回调区分）
    },

    // 2. 初始化：页面加载后执行所有初始化逻辑
    init() {
        // DOM加载完成后初始化（避免重复绑定，统一处理）
        document.addEventListener("DOMContentLoaded", () => {
            this.initializeVerificationPage();
            this.bindEventListeners(); // 绑定所有事件监听
        });

        // 暴露全局方法：兼容原有HTML中的调用（如onclick）
        this.exposeGlobalMethods();
    },

    // 暴露全局方法：确保外部可调用模块内功能
    exposeGlobalMethods() {
        window.triggerUpload = (type) => this.triggerUpload(type);
        window.onImageSelected = (imageUri) => this.onImageSelected(imageUri);
        window.handleImageUpload = (input, previewId) => this.handleImageUpload(input, previewId);
        window.removeImage = (type) => this.removeImage(type);
        window.submitVerification = () => this.submitVerification();
        window.goToProfile = () => this.goToProfile();
        window.simulateVerificationResult = (result) => this.simulateVerificationResult(result);
    },

    // 绑定所有事件监听（统一管理，便于维护）
    bindEventListeners() {
        // 监听姓名、身份证号输入变化，检查提交状态
        const realNameInput = document.getElementById("realName");
        const idNumberInput = document.getElementById("idNumber");
        if (realNameInput) realNameInput.addEventListener("input", () => this.checkSubmitStatus());
        if (idNumberInput) idNumberInput.addEventListener("input", () => this.checkSubmitStatus());
    },

    // 3. 页面核心初始化逻辑
    /**
     * 初始化验证页面：加载审核状态并更新显示
     */
    initializeVerificationPage() {
        // 显示加载状态（若有加载组件可在此处启用）
        const token = this.getAuthToken();
        if (!token) return;

        // 调用接口获取审核状态
        this.fetchAuditStatus(token)
            .then(auditStatus => {
                this.updateVerificationStatus(auditStatus);
            })
            .catch(error => {
                console.error("获取审核状态失败:", error);
                this.showToast(error.message || "获取审核状态失败，请重试");
                // 异常时显示表单，隐藏状态面板
                const verificationStatus = document.getElementById("verificationStatus");
                if (verificationStatus) verificationStatus.style.display = "none";
            });
    },

    // 4. 接口请求相关方法
    /**
     * 获取用户Token（统一封装，便于维护与错误处理）
     * @returns {string} 用户Token或空字符串
     */
    getAuthToken() {
        try {
            const userData = JSON.parse(localStorage.getItem("userData") || "{}");
            const token = userData.token || "";
            if (!token) {
                this.showToast("请先登录");
                return "";
            }
            return token;
        } catch (error) {
            console.error("获取Token失败:", error);
            this.showToast("登录状态异常，请重新登录");
            return "";
        }
    },

    /**
     * 调用接口获取审核状态
     * @param {string} token - 用户认证Token
     * @returns {Promise<Object>} 审核状态数据
     */
    fetchAuditStatus(token) {
        return new Promise((resolve, reject) => {
            fetch(`${this.state.apiConfig.baseUrl}/user/audit/status`, {
                method: "GET",
                headers: {
                    ...this.state.apiConfig.headers,
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json"
                }
            })
                .then(response => this.handleApiResponse(response))
                .then(result => {
                    if (!result.data) {
                        throw new Error("未获取到审核状态数据");
                    }
                    resolve(result.data);
                })
                .catch(error => {
                    reject(error);
                });
        });
    },

    /**
     * 统一处理API响应：标准化错误处理，减少重复代码
     * @param {Response} response - 接口响应对象
     * @returns {Promise<Object>} 解析后的响应数据
     */
    handleApiResponse(response) {
        return new Promise((resolve, reject) => {
            if (!response.ok) {
                reject(new Error(`接口请求失败，状态码: ${response.status}`));
                return;
            }

            response.json()
                .then(result => {
                    if (result.code !== 200) {
                        reject(new Error(result.message || "接口返回业务错误"));
                        return;
                    }
                    resolve(result);
                })
                .catch(error => {
                    reject(new Error("解析响应数据失败: " + error.message));
                });
        });
    },

    // 5. 审核状态显示更新
    /**
     * 更新审核状态显示（根据状态切换UI）
     * @param {Object} auditStatus - 审核状态数据
     * @param {string} auditStatus.status - 审核状态（pending/approved/rejected）
     * @param {string} auditStatus.realName - 真实姓名
     * @param {string} auditStatus.rejectReason - 驳回原因
     * @param {string} auditStatus.submitTime - 提交时间
     * @param {string} auditStatus.auditTime - 审核时间
     */
    updateVerificationStatus(auditStatus) {
        const statusBadge = document.getElementById("statusBadge");
        const statusMessage = document.getElementById("statusMessage");
        const verificationForm = document.getElementById("verificationForm");
        const verificationStatus = document.getElementById("verificationStatus");

        if (!statusBadge || !statusMessage || !verificationForm || !verificationStatus) {
            console.error("状态显示相关DOM元素缺失");
            return;
        }

        // 显示状态面板，初始化样式
        verificationStatus.style.display = "block";
        statusBadge.className = "status-badge";

        // 根据不同状态更新UI
        switch (auditStatus.status || auditStatus) {
            case "pending":
                statusBadge.classList.add("pending");
                statusBadge.textContent = "待审核";
                statusMessage.textContent = `您的身份审核资料已提交（提交时间：${this.formatTime(auditStatus.submitTime)}），我们将在1-3个工作日内完成审核，请耐心等待。`;
                verificationForm.style.display = "none";
                break;

            case "approved":
                statusBadge.classList.add("approved");
                statusBadge.textContent = "已通过";
                statusMessage.textContent = `恭喜您，${auditStatus.realName}，身份审核已通过（审核时间：${this.formatTime(auditStatus.auditTime)}）！您现在可以使用所有支付功能。`;
                verificationForm.style.display = "none";
                break;

            case "rejected":
                statusBadge.classList.add("rejected");
                statusBadge.textContent = "已驳回";
                statusMessage.textContent = `很抱歉，您的身份审核未通过（审核时间：${this.formatTime(auditStatus.auditTime)}）。原因：${auditStatus.rejectReason || "未明确原因"}，请重新提交。`;
                verificationForm.style.display = "block";
                break;

            default:
                // 未知状态：隐藏状态面板，显示表单
                verificationStatus.style.display = "none";
                verificationForm.style.display = "block";
        }
    },

    // 6. 图片上传与预览相关功能
    /**
     * 触发图片上传（兼容原生相册与浏览器文件选择）
     * @param {string} type - 上传类型（frontId：身份证正面，backId：身份证反面）
     */
    triggerUpload(type) {
        this.state.currentUploadType = type; // 记录当前上传类型（替代全局变量）

        // 优先使用原生相册选择（若支持）
        if (window.AndroidInterface) {
            try {
                window.AndroidInterface.openImagePicker("onImageSelected");
                return;
            } catch (error) {
                console.error("调用原生相册失败，切换到浏览器文件选择:", error);
            }
        } else {
            console.log("不支持原生相册，使用浏览器文件选择");
        }

        // 浏览器文件选择：触发隐藏的input点击
        const fileInput = document.getElementById(`${type}Input`);
        if (fileInput) fileInput.click();
    },

    /**
     * 原生相册选择回调函数（接收原生返回的图片URI）
     * @param {string} imageUri - 原生返回的图片URI
     */
    onImageSelected(imageUri) {
        if (!imageUri) {
            this.showToast("未选择图片");
            return;
        }

        const type = this.state.currentUploadType || "frontId";
        this.handleImagePreview(imageUri, type);
    },

    /**
     * 处理浏览器文件选择上传（验证+预览）
     * @param {HTMLInputElement} input - 文件输入元素
     * @param {string} previewId - 预览容器ID（如frontIdPreview）
     */
    handleImageUpload(input, previewId) {
        if (!input.files || input.files.length === 0) {
            this.showToast("未选择图片");
            return;
        }

        const file = input.files[0];
        // 图片类型验证
        if (!file.type.startsWith("image/")) {
            this.showToast("请选择图片文件");
            input.value = ""; // 清空选择，避免重复触发
            return;
        }

        // 图片大小验证（不超过5MB）
        if (file.size > this.state.apiConfig.maxImageSize) {
            this.showToast("图片大小不能超过5MB");
            input.value = "";
            return;
        }

        // 生成预览URL，解析上传类型
        const imageUrl = URL.createObjectURL(file);
        const type = previewId.replace("Preview", ""); // frontIdPreview → frontId

        // 处理预览并清空输入
        this.handleImagePreview(imageUrl, type);
        input.value = "";
    },

    /**
     * 处理图片预览显示（统一预览逻辑，兼容原生与浏览器上传）
     * @param {string} imageUrl - 图片URL/URI
     * @param {string} type - 上传类型（frontId/backId）
     */
    handleImagePreview(imageUrl, type) {
        const imageElement = document.getElementById(`${type}Image`);
        const previewContainer = document.getElementById(`${type}Preview`);
        const uploadContainer = document.getElementById(`${type}Upload`);

        if (!imageElement || !previewContainer || !uploadContainer) {
            console.error(`图片预览相关DOM元素缺失（类型：${type}）`);
            return;
        }

        // 更新预览图片，切换显示状态
        imageElement.src = imageUrl;
        previewContainer.style.display = "block";
        uploadContainer.style.display = "none";

        // 存储图片地址（用于后续提交）
        this.state.uploadedImages[type] = imageUrl;

        // 检查提交按钮状态
        this.checkSubmitStatus();
        this.showToast(`${type === "frontId" ? "身份证正面" : "身份证反面"}上传成功`);
    },

    /**
     * 移除已上传的图片（恢复初始状态）
     * @param {string} type - 上传类型（frontId/backId）
     */
    removeImage(type) {
        const imageElement = document.getElementById(`${type}Image`);
        const previewContainer = document.getElementById(`${type}Preview`);
        const uploadContainer = document.getElementById(`${type}Upload`);
        const fileInput = document.getElementById(`${type}Input`);

        if (!imageElement || !previewContainer || !uploadContainer || !fileInput) {
            console.error(`图片移除相关DOM元素缺失（类型：${type}）`);
            return;
        }

        // 重置UI与数据
        imageElement.src = "";
        previewContainer.style.display = "none";
        uploadContainer.style.display = "block";
        fileInput.value = "";
        delete this.state.uploadedImages[type]; // 从存储中移除

        // 检查提交按钮状态
        this.checkSubmitStatus();
        this.showToast(`${type === "frontId" ? "身份证正面" : "身份证反面"}已移除`);
    },

    // 7. 表单验证与提交
    /**
     * 检查提交按钮状态（根据表单填写情况启用/禁用按钮）
     */
    checkSubmitStatus() {
        const realName = document.getElementById("realName")?.value.trim() || "";
        const idNumber = document.getElementById("idNumber")?.value.trim() || "";
        const frontIdPreview = document.getElementById("frontIdPreview")?.style.display || "none";
        const backIdPreview = document.getElementById("backIdPreview")?.style.display || "none";
        const submitBtn = document.getElementById("submitBtn");

        if (!submitBtn) return;

        // 所有条件满足时启用按钮（姓名、身份证号、正反面图片均已填写/上传）
        submitBtn.disabled = !(realName && idNumber && frontIdPreview === "block" && backIdPreview === "block");
    },

    /**
     * 将图片URI转换为Blob对象（用于原生相册上传的图片提交）
     * @param {string} uri - 图片URI
     * @returns {Promise<Blob>} 转换后的Blob对象
     */
    convertUriToBlob(uri) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", uri, true);
            xhr.responseType = "blob";

            xhr.onload = () => {
                if (xhr.status === 200) {
                    resolve(xhr.response);
                } else {
                    reject(new Error(`获取图片失败: ${xhr.statusText}`));
                }
            };

            xhr.onerror = () => {
                reject(new Error("图片请求失败，请检查权限"));
            };

            xhr.send();
        });
    },

    /**
     * 提交身份验证资料（表单验证+接口请求）
     */
    submitVerification() {
        // 1. 获取表单数据并验证
        const realName = document.getElementById("realName")?.value.trim() || "";
        const idNumber = document.getElementById("idNumber")?.value.trim() || "";
        const frontPreviewImg = document.querySelector("#frontIdPreview .preview-image");
        const backPreviewImg = document.querySelector("#backIdPreview .preview-image");

        // 基础表单验证
        if (!realName) {
            this.showToast("请输入真实姓名");
            return;
        }
        if (!idNumber || !/^\d{17}[\dXx]$/.test(idNumber)) {
            this.showToast("请输入正确的18位身份证号码");
            return;
        }
        if (!frontPreviewImg || !frontPreviewImg.src) {
            this.showToast("请上传身份证正面照片");
            return;
        }
        if (!backPreviewImg || !backPreviewImg.src) {
            this.showToast("请上传身份证反面照片");
            return;
        }

        // 2. 获取用户Token
        const token = this.getAuthToken();
        if (!token) return;

        // 3. 显示加载提示（时长0表示手动关闭，避免提交过程中消失）
        this.showToast("正在提交审核资料...", 0);

        // 4. 构建FormData（兼容浏览器文件与原生相册上传）
        const buildFormData = async () => {
            const formData = new FormData();
            const frontInput = document.getElementById("frontIdInput");
            const backInput = document.getElementById("backIdInput");
            const isBrowserUpload = frontInput?.files?.length > 0 && backInput?.files?.length > 0;

            if (isBrowserUpload) {
                // 浏览器文件上传：直接append文件
                formData.append("idCardFrontFile", frontInput.files[0]);
                formData.append("idCardBackFile", backInput.files[0]);
            } else {
                // 原生相册上传：转换URI为Blob
                try {
                    const frontBlob = await this.convertUriToBlob(frontPreviewImg.src);
                    const backBlob = await this.convertUriToBlob(backPreviewImg.src);
                    formData.append("idCardFrontFile", frontBlob, "idcard_front.jpg");
                    formData.append("idCardBackFile", backBlob, "idcard_back.jpg");
                } catch (error) {
                    throw new Error(`图片处理失败: ${error.message}`);
                }
            }

            return formData;
        };

        // 5. 发送提交请求
        buildFormData()
            .then(formData => {
                                // 构建带查询参数的URL
                const url = new URL(`${this.state.apiConfig.baseUrl}/user/audit/submit`);
                url.searchParams.append("realName", realName);
                url.searchParams.append("idCard", idNumber);

                return fetch(url.toString(), {
                    method: "POST",
                    headers: {
                        ...this.state.apiConfig.headers,
                        "Authorization": `Bearer ${token}`
                    },
                    body: formData
                });
            })
            .then(response => this.handleApiResponse(response))
            .then(result => {
                // 提交成功处理
                this.showToast("审核资料提交成功，等待审核结果");

                // 保存状态并更新UI
                sessionStorage.setItem("verificationStatus", "pending");
                sessionStorage.setItem("verificationName", realName);

                // 更新页面显示为"待审核"状态
                const verificationStatus = document.getElementById("verificationStatus");
                if (verificationStatus) verificationStatus.style.display = "block";
                this.updateVerificationStatus({ status: "pending", submitTime: new Date().toISOString() });
            })
            .catch(error => {
                console.error("提交审核失败:", error);
                this.showToast(error.message || "提交失败，请稍后重试");
            });
    },

    // 8. 工具方法与辅助功能
    /**
     * 格式化时间显示（统一时间格式处理）
     * @param {string} timeStr - 接口返回的时间字符串（如2025-08-11T08:13:28）
     * @returns {string} 格式化后的时间（YYYY-MM-DD HH:mm）
     */
    formatTime(timeStr) {
        if (!timeStr) return "未知时间";

        try {
            const date = new Date(timeStr);
            return `${date.getFullYear()}-${
                String(date.getMonth() + 1).padStart(2, "0")
            }-${
                String(date.getDate()).padStart(2, "0")
            } ${
                String(date.getHours()).padStart(2, "0")
            }:${
                String(date.getMinutes()).padStart(2, "0")
            }`;
        } catch (error) {
            console.error("时间格式化失败:", error);
            // 异常时简单处理（移除T，保留到分钟）
            return timeStr.replace("T", " ").split(":").slice(0, 2).join(":");
        }
    },

    /**
     * 显示Toast提示（统一提示样式与行为）
     * @param {string} message - 提示内容
     * @param {number} duration - 显示时长（毫秒，默认2000ms，0表示不自动关闭）
     */
    showToast(message, duration = 2000) {
        // 移除现有Toast，避免叠加
        const existingToast = document.querySelector(".toast");
        if (existingToast) {
            document.body.removeChild(existingToast);
        }

        // 创建新Toast
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = message;
        // 保留原有样式
        toast.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
        `;

        document.body.appendChild(toast);

        // 自动关闭（duration为0时不自动关闭）
        if (duration > 0) {
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, duration);
        }
    },

    /**
     * 返回个人中心页面
     */
    goToProfile() {
        window.location.href = "profile.html";
    },

    /**
     * 模拟审核结果（测试用）
     * @param {string} result - 模拟结果（verified/rejected）
     */
    simulateVerificationResult(result) {
        // 保存模拟状态
        sessionStorage.setItem("verificationStatus", result);

        // 显示提示
        this.showToast(`模拟审核${result === "verified" ? "通过" : "不通过"}成功`);

        // 更新页面显示
        this.updateVerificationStatus({
            status: result,
            realName: document.getElementById("realName")?.value.trim() || "用户",
            auditTime: new Date().toISOString(),
            rejectReason: result === "rejected" ? "模拟审核不通过（测试用）" : ""
        });
    }
};

// 初始化身份验证模块
VerificationModule.init();
    </script>
</body>

</html>